
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>×©×¢×•×Ÿ ××™××•×Ÿ ××™× ×¡×•×¤×™</title>
  <style>
    :root{
      --bg1:#121826; --bg2:#0f766e; --bg3:#7c3aed;
      --work:#22c55e; --rest:#60a5fa; --accent:#f59e0b; --danger:#ef4444;
      --text:#f8fafc; --muted:#cbd5e1;
      --progress: 0turn;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Rubik", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 800px at 20% 20%, #1f2937 0, transparent 65%),
                  radial-gradient(1000px 700px at 80% 30%, #0b6b94 0, transparent 60%),
                  linear-gradient(135deg, var(--bg1), #0b1220 60%, #0a0c25 100%);
      min-height:100svh;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{
      width:min(960px, 95vw);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:24px;
      align-items:stretch;
    }
    @media (max-width:900px){
      .app{grid-template-columns:1fr; gap:16px}
    }
    .panel{
      background: rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
      border-radius:16px;
      padding:20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    h1{
      margin:0 0 12px;
      font-weight:800; letter-spacing:0.3px;
      background: linear-gradient(90deg, #fff, #c7d2fe 30%, #a7f3d0 70%, #fde68a);
      -webkit-background-clip: text; background-clip:text; color:transparent;
    }
    .subtitle{color:var(--muted); margin-bottom:16px; line-height:1.4}
    .grid{
      display:grid; gap:12px; grid-template-columns:1fr 1fr;
    }
    @media (max-width:520px){ .grid{grid-template-columns:1fr} }
    label{
      font-size:0.95rem; color: var(--muted); margin-bottom:6px; display:block;
    }
    .input{
      display:flex; gap:8px; align-items:center;
      background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.14);
      border-radius:12px; padding:10px 12px;
    }
    .input input{
      width:100%; background:transparent; border:none; outline:none;
      color:var(--text); font-size:1.05rem;
    }
    .hint{font-size:0.85rem; color:#9ca3af; margin-top:4px}
    .controls{ display:flex; gap:12px; margin-top:16px; flex-wrap:wrap; }
    button{
      cursor:pointer; border:none; border-radius:12px; padding:12px 18px;
      font-weight:700; letter-spacing:0.3px; transition: transform .06s ease, filter .2s ease, background .2s ease;
      color:#0b1220;
    }
    button:active{ transform: translateY(1px) scale(0.99) }
    .play{ background:linear-gradient(135deg, #34d399, #22c55e);}
    .pause{ background:linear-gradient(135deg, #60a5fa, #3b82f6);}
    .reset{ background:linear-gradient(135deg, #fbbf24, #f59e0b);}
    .disabled{ filter: grayscale(0.8) brightness(0.8); cursor:not-allowed}
    .ring{
      position:relative; aspect-ratio:1/1; width:100%; max-width:520px;
      margin-inline:auto; place-self:center;
      background:
        radial-gradient(circle at 50% 50%, rgba(255,255,255,0.14) 0 40%, transparent 41%),
        conic-gradient(from -90deg, var(--accent) 0turn var(--progress), rgba(255,255,255,0.08) var(--progress) 1turn);
      border-radius:50%;
      display:grid; place-items:center;
      box-shadow: inset 0 0 40px rgba(0,0,0,0.35), 0 24px 60px rgba(0,0,0,0.35);
    }
    .ring-inner{
      width:76%; height:76%; border-radius:50%;
      background: linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.45));
      border:1px solid rgba(255,255,255,0.2);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      text-align:center; padding:16px;
    }
    .phase{
      font-size:1rem; font-weight:700; letter-spacing:0.6px; margin-bottom:4px;
      padding:4px 10px; border-radius:999px; display:inline-block;
      background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.18);
    }
    .time{
      font-variant-numeric: tabular-nums;
      font-size: clamp(38px, 8vw, 72px);
      font-weight:900; margin:8px 0 2px;
    }
    .rounds{ color:var(--muted); font-size:0.95rem; }
    .footnote{ margin-top:12px; color:#9ca3af; font-size:0.85rem}
    .badge{
      display:inline-flex; align-items:center; gap:8px; font-weight:700;
      padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.18);
      background:linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
    }
    .phase--work{ color:#d1fae5; border-color:#22c55e }
    .phase--rest{ color:#dbeafe; border-color:#60a5fa }
    .legend{ display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
    .chip{ font-size:0.85rem; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.18); background:rgba(255,255,255,0.06); color:#e5e7eb}
    .color-dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-inline:6px}
    .dot-work{background:#22c55e}.dot-rest{background:#60a5fa}
    .errors{ color:#fecaca; background:rgba(239,68,68,0.12); border:1px solid rgba(239,68,68,0.35); padding:8px 12px; border-radius:10px; display:none; margin-top:8px}
    .ok{ color:#bbf7d0; background:rgba(34,197,94,0.12); border:1px solid rgba(34,197,94,0.35); padding:8px 12px; border-radius:10px; display:none; margin-top:8px}
  </style>
</head>
<body>
  <div class="app">
    <!-- ×œ×•×— ×”×‘×§×¨×” -->
    <section class="panel">
      <h1>×©×¢×•×Ÿ ××™××•×Ÿ ××™× ×¡×•×¤×™</h1>
      <div class="subtitle">×‘×—×¨/×™ ×–×× ×™× ×•×œ×—×¥/×™ <b>PLAY</b>. ×”×©×¢×•×Ÿ ×™×¢×‘×•×¨ ×‘×™×Ÿ <b>×ª×¨×’×™×œ</b> ×•<b>×”×¤×¡×§×”</b> ×‘×œ×•×¤ ×¢×“ ×©×ª×œ×—×¥/×™ <b>PAUSE</b>.</div>

      <div class="grid">
        <div>
          <label for="work">××•×¨×š ×ª×¨×’×™×œ</label>
          <div class="input">
            <input id="work" type="text" inputmode="numeric" placeholder="00:30 ××• 30" aria-label="××©×š ×ª×¨×’×™×œ ×‘×©× ×™×•×ª ××• ×‘×¤×•×¨××˜ ×“×§×•×ª:×©× ×™×•×ª">
          </div>
          <div class="hint">××¤×©×¨ ×œ×”×–×™×Ÿ ×©× ×™×•×ª (×œ××©×œ <b>45</b>) ××• ×“×§×•×ª:×©× ×™×•×ª (×œ××©×œ <b>01:00</b>).</div>
        </div>
        <div>
          <label for="rest">××•×¨×š ×”×¤×¡×§×”</label>
          <div class="input">
            <input id="rest" type="text" inputmode="numeric" placeholder="00:10 ××• 10" aria-label="××©×š ×”×¤×¡×§×” ×‘×©× ×™×•×ª ××• ×‘×¤×•×¨××˜ ×“×§×•×ª:×©× ×™×•×ª">
          </div>
          <div class="hint">×”××œ×¦×”: ×”×¤×¡×§×” ×§×¦×¨×” (10â€“20 ×©× ×™×•×ª) ×œ×©××™×¨×” ×¢×œ ×§×¦×‘ ğŸ”¥</div>
        </div>
      </div>

      <div class="controls">
        <button id="playPause" class="play">â–¶ PLAY</button>
        <button id="reset" class="reset">â†º RESET</button>
      </div>

      <div id="msgErr" class="errors"></div>
      <div id="msgOk" class="ok">××•×›×Ÿ! ××¤×©×¨ ×œ×œ×—×•×¥ PLAY ğŸ™‚</div>

      <div class="legend">
        <span class="chip"><span class="color-dot dot-work"></span> ×ª×¨×’×™×œ</span>
        <span class="chip"><span class="color-dot dot-rest"></span> ×”×¤×¡×§×”</span>
      </div>
      <div class="footnote">×˜×™×¤: ×œ×—×™×¦×” ×¢×œ PLAY ××¤×¢×™×œ×” ×’× ××ª ×”××•×“×™×• (× ×“×¨×© ×‘×“×¤×“×¤× ×™× × ×™×™×“×™×).</div>
    </section>

    <!-- ×”×ª×¦×•×’×” -->
    <section class="panel">
      <div id="ring" class="ring" style="--progress:0turn;">
        <div class="ring-inner" id="ringInner">
          <div id="phase" class="phase phase--work">×ª×¨×’×™×œ</div>
          <div id="time" class="time">00:00</div>
          <div class="rounds" id="rounds">×¡×‘×‘: 0</div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // -------- ×©×™×¨×•×ª: ×¢×™×‘×•×“ ×–×× ×™× --------
    function parseTimeToSeconds(v){
      if(!v) return NaN;
      v = String(v).trim();
      if(v.includes(":")){
        const [m,s] = v.split(":").map(x => parseInt(x || "0",10));
        if(Number.isNaN(m) || Number.isNaN(s)) return NaN;
        return Math.max(0, m*60 + s);
      } else {
        const n = parseInt(v,10);
        return Number.isFinite(n) ? Math.max(0, n) : NaN;
      }
    }
    function formatSeconds(sec){
      sec = Math.max(0, Math.floor(sec));
      const m = String(Math.floor(sec/60)).padStart(2,"0");
      const s = String(sec%60).padStart(2,"0");
      return `${m}:${s}`;
    }

    // -------- ××•×“×™×•: ×¦×¤×¦×•×¤×™× ×©×•× ×™× --------
    let audioCtx = null;
    function ensureAudio(){
      if(!audioCtx){
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if(audioCtx.state === "suspended") {
        audioCtx.resume();
      }
    }
    function beep({freq=880, duration=150, type="sine", volume=0.08} = {}){
      if(!audioCtx) return;
      const ctx = audioCtx;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = type;
      osc.frequency.setValueAtTime(freq, ctx.currentTime);
      // ××¢×˜×¤×ª ×§×¦×¨×” ×©×ª×™×©××¢ × ×¢×™×
      const t0 = ctx.currentTime;
      gain.gain.setValueAtTime(0, t0);
      gain.gain.linearRampToValueAtTime(volume, t0 + 0.01);
      gain.gain.linearRampToValueAtTime(0.0001, t0 + duration/1000);

      osc.connect(gain).connect(ctx.destination);
      osc.start(t0);
      osc.stop(t0 + duration/1000 + 0.01);
    }
    function wait(ms){ return new Promise(res => setTimeout(res, ms)); }

    async function beepSequenceWork(){
      // ×ª×¨×’×™×œ ×”×¡×ª×™×™×: 3 ×¦×¤×¦×•×¤×™× ×’×‘×•×”×™× ×•×§×¦×¨×™×
      for(let i=0;i<3;i++){
        beep({freq: 980, duration: 140, type: "triangle", volume: 0.09});
        await wait(140);
      }
    }
    async function beepSequenceRest(){
      // ×”×¤×¡×§×” ×”×¡×ª×™×™××”: 2 ×¦×¤×¦×•×¤×™× × ××•×›×™×, ××¨×•×‘×¢×™× (×¦×œ×™×œ ×©×•× ×”)
      for(let i=0;i<2;i++){
        beep({freq: 520, duration: 200, type: "square", volume: 0.10});
        await wait(220);
      }
    }

    // -------- ×œ×•×’×™×§×ª ×˜×™×™××¨ --------
    const elPhase = document.getElementById('phase');
    const elTime  = document.getElementById('time');
    const elRounds= document.getElementById('rounds');
    const elRing  = document.getElementById('ring');
    const elRingInner = document.getElementById('ringInner');
    const elPlayPause = document.getElementById('playPause');
    const elReset = document.getElementById('reset');
    const elWork = document.getElementById('work');
    const elRest = document.getElementById('rest');
    const elErr  = document.getElementById('msgErr');
    const elOk   = document.getElementById('msgOk');

    let isRunning = false;
    let phase = 'work';        // 'work' | 'rest'
    let workSec = 0;
    let restSec = 0;
    let remaining = 0;         // ×©× ×™×•×ª ×©× ×•×ª×¨×• ×‘××¦×‘ ×”× ×•×›×—×™
    let phaseEndTs = 0;        // ××ª×™ ×”××§×˜×¢ ××¡×ª×™×™× (××™×œ×™×©× ×™×•×ª)
    let rounds = 0;
    let rafId = 0;

    function setMessage(err){
      if(err){
        elErr.style.display='block';
        elErr.textContent = err;
        elOk.style.display='none';
      } else {
        elErr.style.display='none';
        elOk.style.display='block';
      }
    }

    function setPhase(newPhase){
      phase = newPhase;
      if(phase === 'work'){
        elPhase.textContent = '×ª×¨×’×™×œ';
        elPhase.classList.remove('phase--rest');
        elPhase.classList.add('phase--work');
        elRing.style.setProperty('--accent', '#22c55e');
        elRingInner.style.borderColor = 'rgba(34,197,94,0.35)';
      } else {
        elPhase.textContent = '×”×¤×¡×§×”';
        elPhase.classList.remove('phase--work');
        elPhase.classList.add('phase--rest');
        elRing.style.setProperty('--accent', '#60a5fa');
        elRingInner.style.borderColor = 'rgba(59,130,246,0.35)';
      }
    }

    function startPhase(durationSec){
      remaining = durationSec;
      phaseEndTs = performance.now() + durationSec*1000;
    }

    function updateProgress(){
      // ×¢×“×›×•×Ÿ ×–××Ÿ ×•×ª×¦×•×’×”
      const total = (phase === 'work') ? workSec : restSec;
      const now = performance.now();
      const leftMs = Math.max(0, phaseEndTs - now);
      remaining = leftMs / 1000;
      elTime.textContent = formatSeconds(remaining);
      // ×”×ª×§×“××•×ª ×‘×¢×™×’×•×œ (0..1 turn)
      const done = Math.min(1, (total - remaining) / Math.max(1e-9, total));
      elRing.style.setProperty('--progress', `${done}turn`); // 'turn' ×›×“×™ ×œ×§×‘×œ 0..1 ×¡×™×‘×•×‘

      if(isRunning){
        if(leftMs <= 0){
          // ×¡×™×•× ×”××§×˜×¢ ×”× ×•×›×—×™ â†’ ×¦×¤×¦×•×¤×™× + ××¢×‘×¨ ×œ×©×œ×‘ ×”×‘×
          (phase === 'work' ? beepSequenceWork() : beepSequenceRest());
          if(phase === 'work'){
            // ×¡×™×•× ×ª×¨×’×™×œ â†’ ××ª×—×™×œ×” ×”×¤×¡×§×”
            setPhase('rest');
            startPhase(restSec);
          } else {
            // ×¡×™×•× ×”×¤×¡×§×” â†’ ××ª×—×™×œ ×ª×¨×’×™×œ ×—×“×©
            setPhase('work');
            startPhase(workSec);
            rounds++;
            elRounds.textContent = `×¡×‘×‘: ${rounds}`;
          }
        }
        rafId = requestAnimationFrame(updateProgress);
      }
    }

    function play(){
      // ×•×•×œ×™×“×¦×™×” + ×”×›× ×”
      workSec = parseTimeToSeconds(elWork.value || '30');
      restSec = parseTimeToSeconds(elRest.value || '10');

      if(!Number.isFinite(workSec) || workSec <= 0){
        setMessage('×× × ×”×–×Ÿ ××•×¨×š ×ª×¨×’×™×œ ×ª×§×™×Ÿ (>0).');
        return;
      }
      if(!Number.isFinite(restSec) || restSec <= 0){
        setMessage('×× × ×”×–×Ÿ ××•×¨×š ×”×¤×¡×§×” ×ª×§×™×Ÿ (>0).');
        return;
      }
      setMessage('');

      ensureAudio();

      // ×× ××ª×—×™×œ×™× ×××¤×¡ (×œ× ×¤×•×– ×”×™×¡×˜×•×¨×™), ×§×‘×¢ ×©×œ×‘ ×ª×¨×’×™×œ ×—×“×©
      if(!isRunning && remaining <= 0){
        setPhase('work');
        startPhase(workSec);
      } else {
        // ×× ×—×–×¨× ×• ×-PAUSE, ×”××©×š ××”×–××Ÿ ×©× ×•×ª×¨
        phaseEndTs = performance.now() + remaining*1000;
      }

      isRunning = true;
      elPlayPause.textContent = 'â¸ PAUSE';
      elPlayPause.classList.remove('play');
      elPlayPause.classList.add('pause');
      cancelAnimationFrame(rafId);
      rafId = requestAnimationFrame(updateProgress);
    }

    function pause(){
      isRunning = false;
      cancelAnimationFrame(rafId);
      elPlayPause.textContent = 'â–¶ PLAY';
      elPlayPause.classList.remove('pause');
      elPlayPause.classList.add('play');
    }

    function reset(){
      pause();
      rounds = 0;
      elRounds.textContent = '×¡×‘×‘: 0';
      setPhase('work');
      remaining = 0;
      elTime.textContent = '00:00';
      elRing.style.setProperty('--progress', `0turn`);
      setMessage('××•×›×Ÿ! ××¤×©×¨ ×œ×œ×—×•×¥ PLAY ğŸ™‚');
    }

    elPlayPause.addEventListener('click', () => {
      if(isRunning){ pause(); } else { play(); }
    });
    elReset.addEventListener('click', reset);

    // ×”×•×“×¢×ª ×‘×¨×™×¨×ª ××—×“×œ
    setMessage('××•×›×Ÿ! ××¤×©×¨ ×œ×œ×—×•×¥ PLAY ğŸ™‚');

    // ×¢×¨×›×™ ×“×•×’××”
    elWork.value = '00:30';
    elRest.value = '00:10';
  </script>
</body>
</html>
